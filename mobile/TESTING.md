# 测试文档

## 测试环境准备

### 1. 后端服务

确保后端服务已启动：
- 后端地址：`http://localhost:8080/api`
- 数据库和Redis服务已启动

### 2. Android模拟器配置

#### 使用Android Studio模拟器

1. 启动Android Studio
2. 打开AVD Manager创建或启动模拟器
3. 模拟器默认使用 `10.0.2.2` 访问宿主机 `localhost`

#### 使用真机测试

1. 确保手机和电脑在同一局域网
2. 获取电脑的局域网IP地址（Windows: `ipconfig`, Mac/Linux: `ifconfig`）
3. 修改 `src/config/api.js` 中的 `DEV_API_URL` 为电脑IP地址
   ```javascript
   const DEV_API_URL = 'http://192.168.x.x:8080/api';
   ```

### 3. 安装依赖

```bash
cd mobile
npm install
# 或
yarn install
```

### 4. 启动Metro服务器

```bash
npm start
```

### 5. 运行Android应用

```bash
npm run android
```

## 测试用例

### 1. 登录功能测试

#### 1.1 用户名密码登录

**测试步骤：**
1. 打开应用，默认显示登录页面
2. 选择"账号密码"选项卡
3. 输入用户名：`1111`
4. 输入密码：`111111`
5. 点击"登录"按钮

**预期结果：**
- ✅ 登录成功，跳转到用户信息页面
- ✅ Token已保存到本地存储
- ✅ 用户信息正确显示

**异常测试：**
- ❌ 输入错误密码：显示"用户名或密码错误"
- ❌ 输入不存在的用户名：显示"用户名或密码错误"
- ❌ 网络断开：显示"网络连接失败，请检查网络设置"

#### 1.2 手机验证码登录

**测试步骤：**
1. 选择"手机验证码"选项卡
2. 输入手机号：`13800138000`（需要后端有此用户）
3. 点击"获取验证码"按钮
4. 输入收到的验证码
5. 点击"登录"按钮

**预期结果：**
- ✅ 验证码发送成功
- ✅ 倒计时60秒，期间按钮禁用
- ✅ 登录成功，跳转到用户信息页面

**异常测试：**
- ❌ 手机号格式错误：显示"请输入正确的手机号"
- ❌ 验证码错误：显示相应错误信息
- ❌ 验证码过期：显示"验证码已过期"

### 2. 用户信息展示测试

**测试步骤：**
1. 登录成功后进入用户信息页面
2. 查看用户信息显示

**预期结果：**
- ✅ 显示用户头像（用户名首字母）
- ✅ 显示用户名
- ✅ 显示用户ID
- ✅ 显示邮箱
- ✅ 显示手机号

### 3. Token管理测试

#### 3.1 Token自动刷新

**测试步骤：**
1. 登录成功后，等待AccessToken过期（默认1小时）
2. 访问需要认证的接口（如获取用户信息）

**预期结果：**
- ✅ Token自动刷新
- ✅ 请求成功执行
- ✅ 新Token已保存

#### 3.2 Token过期处理

**测试步骤：**
1. 手动清除Token或等待RefreshToken过期
2. 尝试访问需要认证的接口

**预期结果：**
- ✅ 自动跳转到登录页面
- ✅ 显示"登录已过期，请重新登录"

### 4. 登出功能测试

**测试步骤：**
1. 在用户信息页面点击"退出登录"按钮
2. 确认退出

**预期结果：**
- ✅ 显示确认对话框
- ✅ 点击"确定"后清除Token和用户信息
- ✅ 跳转到登录页面
- ✅ 无法访问需要认证的接口

### 5. 网络异常处理测试

**测试步骤：**
1. 断开网络连接
2. 尝试登录或获取用户信息

**预期结果：**
- ✅ 显示友好的错误提示："网络连接失败，请检查网络设置"
- ✅ 应用不崩溃

### 6. 应用重启测试

**测试步骤：**
1. 登录成功后关闭应用
2. 重新打开应用

**预期结果：**
- ✅ 自动检查Token有效性
- ✅ 如果Token有效，直接进入用户信息页面
- ✅ 如果Token无效，跳转到登录页面

## 性能测试

### 1. 启动时间

- 冷启动时间应 < 3秒
- 热启动时间应 < 1秒

### 2. 网络请求

- API请求响应时间应 < 2秒
- Token刷新应在后台静默完成

### 3. 内存使用

- 应用内存占用应 < 200MB

## 兼容性测试

### Android版本

- ✅ Android 5.0 (API 21) 及以上

### 屏幕尺寸

- ✅ 小屏手机（4.7英寸）
- ✅ 大屏手机（6.5英寸）
- ✅ 平板设备

### 网络环境

- ✅ WiFi
- ✅ 4G/5G移动网络
- ✅ 弱网环境

## 已知问题

1. **Android模拟器网络问题**
   - 如果无法连接后端，检查防火墙设置
   - 确保使用 `10.0.2.2` 而不是 `localhost`

2. **Token刷新循环依赖**
   - 已通过动态导入解决
   - 如果仍有问题，检查 `TokenManager.js` 和 `api/index.js`

3. **导航状态更新**
   - 使用 `updateAuthState` 回调函数更新导航状态
   - 确保登录和登出时都调用此函数

## 调试技巧

### 1. 查看日志

```bash
# Android日志
adb logcat | grep ReactNativeJS
```

### 2. 清除应用数据

```bash
adb shell pm clear com.logindemo
```

### 3. 重新安装应用

```bash
npm run android
```

### 4. 检查网络请求

使用Charles Proxy或Fiddler抓包查看API请求和响应

## 测试报告模板

```
测试日期：YYYY-MM-DD
测试人员：XXX
测试环境：Android X.X / 模拟器/真机

功能测试：
- [ ] 用户名密码登录
- [ ] 手机验证码登录
- [ ] 用户信息展示
- [ ] Token自动刷新
- [ ] 登出功能
- [ ] 网络异常处理

性能测试：
- [ ] 启动时间
- [ ] 网络请求响应时间
- [ ] 内存使用

兼容性测试：
- [ ] Android版本兼容性
- [ ] 屏幕尺寸适配
- [ ] 网络环境

问题记录：
1. [问题描述]
   - 复现步骤：
   - 预期结果：
   - 实际结果：
   - 截图/日志：
```

