# 通用登录系统MVP需求文档

## 1. 产品概述

### 1.1 产品定位
设计并实现一个通用的登录系统，作为微服务架构中的独立认证服务，可以被任意系统集成和调用，提供统一的用户认证、授权和会话管理功能。

### 1.2 MVP范围
- 用户注册
- 用户登录认证
- 会话管理（Token/JWT颁发与验证）
- 统一的登录界面
- 基础的错误处理和日志记录

## 2. 功能需求

### 2.1 用户认证功能
- **用户注册**：支持新用户通过邮箱/手机号注册账号
- **用户登录**：支持用户名/密码登录方式
- **登录验证**：验证用户凭据的有效性
- **会话创建**：登录成功后创建用户会话，生成认证Token
- **会话验证**：提供接口验证Token的有效性
- **会话注销**：支持用户主动登出

### 2.2 安全需求
- **密码加密**：用户密码使用加盐哈希存储
- **Token安全**：JWT Token包含过期时间，支持刷新机制
- **防暴力攻击**：限制同一账号短时间内的登录失败次数
- **请求验证**：支持请求参数验证，防止恶意输入
- **跨域安全**：配置CORS策略，限制跨域访问

### 2.3 系统接口
- **认证接口**：提供登录、注册、登出等REST API
- **Token管理接口**：提供Token验证、刷新等功能
- **用户信息接口**：提供获取用户基本信息的接口

### 2.4 前端功能
- **登录页面**：包含用户名、密码输入框和登录按钮
- **注册页面**：包含注册表单和提交按钮
- **登录状态管理**：管理用户登录状态，处理过期和失效情况
- **错误提示**：友好的错误信息展示

## 3. 非功能需求

### 3.1 性能需求
- **响应时间**：登录请求响应时间不超过500ms
- **并发能力**：支持每秒至少100个登录请求
- **资源消耗**：内存占用不超过512MB，CPU使用率峰值不超过50%

### 3.2 可用性需求
- **系统可用性**：达到99.9%
- **故障恢复**：系统崩溃后能够自动恢复并保持数据一致性

### 3.3 可扩展性需求
- **模块化设计**：系统各组件低耦合，便于扩展其他认证方式
- **配置化**：关键参数通过配置文件管理，无需修改代码

### 3.4 可维护性需求
- **日志记录**：详细的操作日志和错误日志
- **监控指标**：提供基础的性能和错误监控指标
- **代码规范**：遵循Java和Vue/React的代码规范

## 4. 技术架构

### 4.1 技术栈选择

#### 后端技术栈
- **框架**：Spring Boot 2.7.x
- **数据库**：MySQL 8.0
- **缓存**：Redis 6.x（用于缓存和限流）
- **认证方案**：JWT (JSON Web Token)
- **ORM框架**：MyBatis-Plus
- **API文档**：Swagger/OpenAPI
- **日志框架**：SLF4J + Logback
- **安全框架**：Spring Security

#### 前端技术栈
- **框架**：Vue 3 + Vite（或React + Vite）
- **状态管理**：Pinia（或Redux）
- **UI组件库**：Element Plus（或Ant Design）
- **网络请求**：Axios
- **表单验证**：Vee-validate（或React Hook Form）
- **路由**：Vue Router（或React Router）

### 4.2 系统架构设计

#### 架构图
```
前端应用 <----> 认证服务API <----> Spring Security <----> 业务逻辑层 <----> 数据访问层 <----> 数据库
                                     |
                                     v
                                  Redis缓存
```

#### 模块划分
- **api模块**：提供RESTful API接口
- **auth模块**：处理认证和授权逻辑
- **user模块**：管理用户信息
- **common模块**：提供通用工具类和异常处理

### 4.3 数据模型设计

#### 用户表(users)
| 字段名 | 数据类型 | 描述 | 约束 |
|-------|---------|------|------|
| id | BIGINT | 用户ID | 主键，自增 |
| username | VARCHAR(50) | 用户名 | 唯一，非空 |
| password | VARCHAR(255) | 密码哈希 | 非空 |
| email | VARCHAR(100) | 邮箱 | 唯一，非空 |
| phone | VARCHAR(20) | 手机号 | 唯一 |
| status | TINYINT | 状态(0:禁用,1:启用) | 默认1 |
| created_at | DATETIME | 创建时间 | 非空 |
| updated_at | DATETIME | 更新时间 | 非空 |

#### 角色表(roles) - 预留扩展
| 字段名 | 数据类型 | 描述 | 约束 |
|-------|---------|------|------|
| id | BIGINT | 角色ID | 主键，自增 |
| name | VARCHAR(50) | 角色名称 | 唯一，非空 |
| description | VARCHAR(255) | 角色描述 |
| created_at | DATETIME | 创建时间 | 非空 |

## 5. 详细设计

### 5.1 后端接口设计

#### 认证相关接口
- **POST /api/auth/register**：用户注册
- **POST /api/auth/login**：用户登录
- **POST /api/auth/logout**：用户登出
- **POST /api/auth/refresh**：刷新Token
- **GET /api/auth/validate**：验证Token有效性

#### 用户相关接口
- **GET /api/users/me**：获取当前登录用户信息

### 5.2 前端页面设计

#### 登录页面
- 用户名/邮箱输入框
- 密码输入框
- 记住密码复选框
- 登录按钮
- 注册入口
- 错误信息提示区域

#### 注册页面
- 用户名输入框
- 邮箱输入框
- 密码输入框
- 确认密码输入框
- 注册按钮
- 登录入口
- 错误信息提示区域

## 6. 部署与集成

### 6.1 依赖要求
- JDK 11+
- Maven 3.6+
- Node.js 16+
- npm 8+
- MySQL 8.0+
- Redis 6.0+

### 6.2 配置项
- 数据库连接信息
- Redis连接信息
- JWT密钥和过期时间配置
- CORS配置
- 登录失败限制配置

### 6.3 集成说明
其他系统集成此认证服务的方式说明，包括：
- Token验证机制
- 用户信息获取
- 登录状态同步

## 7. 测试计划

### 7.1 功能测试
- 用户注册功能测试
- 用户登录功能测试
- 密码错误处理测试
- Token生成和验证测试
- 登出功能测试

### 7.2 性能测试
- 并发登录测试
- Token验证性能测试

### 7.3 安全测试
- 密码加密验证
- SQL注入防护测试
- XSS防护测试
- CSRF防护测试

## 8. 项目计划

### 8.1 时间线
- **第1-2天**：需求分析和系统设计
- **第3-5天**：后端服务开发
- **第6-8天**：前端页面开发
- **第9天**：系统集成和测试
- **第10天**：文档完善和部署

### 8.2 里程碑
- 需求文档完成
- 后端API开发完成
- 前端页面开发完成
- 系统集成测试通过
- 部署上线

## 9. 风险评估

### 9.1 潜在风险
- 安全性风险：密码存储和Token管理的安全性
- 性能风险：高并发下的系统响应时间
- 集成风险：与其他系统集成时的兼容性

### 9.2 风险应对
- 严格遵循安全最佳实践，进行代码安全审查
- 进行性能测试和优化
- 提供详细的集成文档和示例