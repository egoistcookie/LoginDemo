# 微信小程序调试指南

本文档介绍如何在微信开发者工具中调试LoginDemo小程序。

## 一、环境准备

### 1. 安装微信开发者工具

1. 访问 [微信开发者工具官网](https://developers.weixin.qq.com/miniprogram/dev/devtools/download.html)
2. 下载并安装最新版本的微信开发者工具
3. 使用微信扫码登录开发者工具

### 2. 创建小程序项目

1. 打开微信开发者工具
2. 点击"+"创建新项目
3. 选择项目目录：选择 `miniprogram` 文件夹
4. AppID设置：
   - **开发阶段**：选择"测试号"或"使用测试号"
   - **正式发布**：需要在小程序后台注册并获取正式AppID
5. 项目名称：LoginDemo
6. 点击"确定"创建项目

## 二、配置后端API地址

### 1. 修改API配置

打开 `miniprogram/config/api.js` 文件，修改 `DEV_API_URL`：

```javascript
// 开发环境API地址配置
// 注意：微信小程序中不能使用localhost，需要使用电脑的局域网IP地址

// Windows系统获取IP方法：
// 1. 打开命令提示符（CMD）
// 2. 输入 ipconfig
// 3. 找到"IPv4 地址"，例如：192.168.1.100

// Mac/Linux系统获取IP方法：
// 1. 打开终端
// 2. 输入 ifconfig
// 3. 找到 inet 地址，例如：192.168.1.100

const DEV_API_URL = 'http://192.168.1.100:8080/api'; // 替换为你的电脑IP地址
```

### 2. 确保后端服务运行

1. 启动后端Spring Boot服务（默认端口：8080）
2. 确认后端服务可以正常访问
3. 测试API接口是否正常：
   ```bash
   # 测试登录接口
   curl -X POST http://localhost:8080/api/auth/login \
     -H "Content-Type: application/json" \
     -d '{"username":"test","password":"test"}'
   ```

## 三、开发者工具设置

### 1. 不校验合法域名（开发阶段）

1. 在微信开发者工具中，点击右上角的"详情"
2. 在"本地设置"标签页中
3. 勾选"不校验合法域名、web-view（业务域名）、TLS 版本以及 HTTPS 证书"
4. 这个选项允许在开发阶段访问本地服务器

### 2. 启用调试模式

1. 在 `app.json` 中已经设置了 `"debug": true`
2. 这会在控制台输出详细的调试信息

## 四、调试方法

### 1. 查看控制台日志

1. 在微信开发者工具底部，点击"Console"标签
2. 可以看到：
   - `console.log()` 输出的日志
   - 网络请求信息
   - 错误信息

**常用调试代码：**
```javascript
// 在页面JS文件中添加
console.log('调试信息', data);
console.error('错误信息', error);
```

### 2. 查看网络请求

1. 在微信开发者工具底部，点击"Network"标签
2. 可以看到所有HTTP请求：
   - 请求URL
   - 请求方法
   - 请求头
   - 请求体
   - 响应状态码
   - 响应数据

**调试网络请求：**
- 点击某个请求，可以查看详细信息
- 检查请求URL是否正确
- 检查请求头是否包含Token
- 检查响应数据格式

### 3. 使用断点调试

1. 在代码编辑器中，点击行号左侧设置断点（红色圆点）
2. 运行小程序，当执行到断点时会暂停
3. 可以查看：
   - 变量值
   - 调用栈
   - 单步执行

### 4. 查看存储数据

1. 在微信开发者工具中，点击"Storage"标签
2. 可以看到本地存储的数据：
   - `accessToken` - 访问令牌
   - `refreshToken` - 刷新令牌
   - `userInfo` - 用户信息

**手动操作存储：**
- 可以手动添加、修改、删除存储数据
- 用于测试不同状态下的页面表现

### 5. 使用AppData面板

1. 在微信开发者工具中，点击"AppData"标签
2. 可以看到当前页面的数据状态
3. 可以实时修改数据，查看页面变化

## 五、常见问题排查

### 1. 网络请求失败

**问题：** 请求失败，提示"网络连接失败"

**排查步骤：**
1. 检查后端服务是否启动
2. 检查API地址配置是否正确（不能使用localhost）
3. 检查电脑防火墙是否阻止了8080端口
4. 检查手机/模拟器与电脑是否在同一网络

**解决方案：**
- 使用电脑的局域网IP地址（如：192.168.1.100）
- 确保后端服务允许跨域访问（CORS配置）
- 在开发者工具中开启"不校验合法域名"

### 2. Token认证失败

**问题：** 请求返回401未授权错误

**排查步骤：**
1. 检查登录是否成功，Token是否正确保存
2. 在Storage面板查看是否有accessToken
3. 在Network面板查看请求头是否包含Authorization

**解决方案：**
- 重新登录获取新的Token
- 检查Token是否过期（默认1小时）
- 检查后端JWT配置是否正确

### 3. 页面无法跳转

**问题：** 登录成功后无法跳转到用户信息页

**排查步骤：**
1. 检查页面路径是否正确
2. 检查 `app.json` 中是否注册了页面
3. 查看控制台是否有错误信息

**解决方案：**
- 确保页面路径正确：`/pages/profile/profile`
- 确保 `app.json` 的 `pages` 数组中包含页面路径

### 4. 数据不显示

**问题：** 用户信息页面显示空白或"-"

**排查步骤：**
1. 检查API响应数据格式是否正确
2. 检查页面数据绑定是否正确
3. 查看控制台是否有错误信息

**解决方案：**
- 在Network面板查看API响应数据
- 检查响应数据格式：`{code: 200, message: "success", data: {...}}`
- 检查页面WXML中的数据绑定路径

### 5. 样式显示异常

**问题：** 页面样式不正确或布局错乱

**排查步骤：**
1. 检查WXSS文件是否正确引入
2. 检查样式类名是否正确
3. 检查是否有样式冲突

**解决方案：**
- 清除缓存重新编译
- 检查WXSS语法是否正确
- 使用开发者工具的样式调试功能

## 六、真机调试

### 1. 预览到手机

1. 点击微信开发者工具右上角的"预览"按钮
2. 使用微信扫码
3. 在手机上打开小程序

**注意事项：**
- 手机和电脑必须在同一局域网
- API地址必须使用电脑的局域网IP
- 确保后端服务允许手机访问

### 2. 真机调试

1. 点击微信开发者工具右上角的"真机调试"按钮
2. 使用微信扫码
3. 在手机上打开小程序
4. 可以在开发者工具中查看真机的日志和网络请求

## 七、性能优化建议

### 1. 减少不必要的请求

- 使用本地缓存存储用户信息
- 避免频繁调用API

### 2. 优化页面加载

- 使用骨架屏提升用户体验
- 合理使用图片资源

### 3. 代码优化

- 避免在页面加载时执行耗时操作
- 使用防抖和节流优化用户输入

## 八、发布前检查清单

- [ ] 修改API地址为生产环境地址
- [ ] 移除或关闭调试模式（`app.json` 中的 `debug: false`）
- [ ] 在小程序后台配置服务器域名白名单
- [ ] 测试所有功能是否正常
- [ ] 检查是否有控制台错误
- [ ] 优化代码和资源文件大小

## 九、参考资源

- [微信小程序官方文档](https://developers.weixin.qq.com/miniprogram/dev/framework/)
- [微信开发者工具使用指南](https://developers.weixin.qq.com/miniprogram/dev/devtools/devtools.html)
- [小程序网络请求文档](https://developers.weixin.qq.com/miniprogram/dev/api/network/request/wx.request.html)

